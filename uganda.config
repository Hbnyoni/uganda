/*
========================================================================================
    UGANDA-FOCUSED ENHANCED NEXTFLOW CONFIGURATION
========================================================================================
*/

// Global parameters for Uganda enhanced analysis
params {
    // Enable conda environment
    enable_conda = true
    
    // Resource settings
    max_cpus = 4
    max_memory = '8.GB'
    max_time = '6.h'  // Increased for enhanced processing
    
    // Output settings
    tracedir = "${params.output_dir}/pipeline_info"
    
    // Enhanced interpolation settings
    enable_interpolation = true
    max_days_per_variable = 30  // Reduced for performance
    interpolation_method = 'kriging'  // kriging, idw, rbf
    grid_resolution = 0.005  // degrees (higher resolution)
    variogram_model = 'spherical'  // linear, power, gaussian, spherical, exponential
    
    // GeoTIFF and processing settings
    create_geotiff = true
    create_geostack = true
    output_crs = 'EPSG:4326'
    compress_geotiff = 'lzw'
    
    // Enhanced visualization
    create_spatial_distribution = true
    create_enhanced_maps = true
}

profiles {
    conda {
        params.enable_conda = true
        conda.enabled = true
        conda.envPath = '/opt/conda/envs/cheaqi'
    }
    
    docker {
        docker.enabled = true
        docker.userEmulation = true
        
        // Use current container
        process.container = 'cheaqi-docker-cheaqi-web'
    }
}

// Export these variables to prevent conflicts
env {
    PYTHONNOUSERSITE = 1
    R_PROFILE_USER = "/.Rprofile"
    R_ENVIRON_USER = "/.Renviron"
}

// Process settings
process.shell = ['/bin/bash', '-euo', 'pipefail']

// Execution reporting
def trace_timestamp = new java.util.Date().format('yyyy-MM-dd_HH-mm-ss')
timeline {
    enabled = true
    file = "${params.tracedir}/uganda_timeline_${trace_timestamp}.html"
}
report {
    enabled = true
    file = "${params.tracedir}/uganda_report_${trace_timestamp}.html"
}
trace {
    enabled = true
    file = "${params.tracedir}/uganda_trace_${trace_timestamp}.txt"
}
dag {
    enabled = true
    file = "${params.tracedir}/uganda_dag_${trace_timestamp}.svg"
}

manifest {
    name = 'CHEAQI-Uganda-Analysis'
    author = 'CHEAQI Team'
    description = 'Uganda-focused spatial interpolation with maps and animations'
    mainScript = 'uganda_workflow.nf'
    nextflowVersion = '>=21.10.3'
    version = '1.0.0'
}